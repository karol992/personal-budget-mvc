{% extends 'navbar.html' %}

{% block title %}Settings{% endblock %}

{% block css_styles %}
	
	<link rel="stylesheet" href="/css/settings.css">
{% endblock %}

{% block body %}
<div id="info_ribbon"></div>
	
<section id="pageContent">
	{% include 'Settings/pageContent.html' %}
</section>	
		
		<br />

<section id="modals">

	<section id="incomeModals">
		{% include 'Settings/incomeModals.html' %}
	</section>

	<section id="expenseModals">

	</section>
	
	<section id="paymentModals">

	</section>

	<section id="accountDataModals">
		{% include 'Settings/accountDataModals.html' %}
	</section>
	
</section>

{% endblock %}

{% block footer %}
<script src="/js/modal.js"></script>
<script src="/js/hideShowPassword.min.js"></script>
<script src="/js/settingsValidation.js"></script>
<script>
const $form = $('#addIncomeCategory');
const $submitBtn = $("#addIncomeCategoryBtn");
const $info = $("#addIncomeCategoryInfo");
$form.on("submit", function(e) {
    e.preventDefault();
    $submitBtn.prop('disabled', true);
	$.ajax({
        url: '/settings/add-income-category-ajax',
        method : "POST",
        dataType : "json",
        data: $(this).serialize()
    }).done(function(response) {
			if(response.success) {
			var categoryId = response.id;
			var categoryName = response.name;
			var limit = 0.00;
			$('#aaa').append(
				$('<li class="modal_line modal_cell row shadow">').append(
					$('<div class="modal_cell col-12"  style="position: relative;">').append(
						$('<span>').append('<span>'+categoryName+' (Limit: <span id="income'+categoryId+'limit">'+limit.toPrecision(3)+'</span>)</span>'),
						$('<div class="btn-group vertical_center right" role="group" aria-label="Basic example">').append(
							$('<button type="button" class="btn btn_record income_edit" href="#incomeEditModal" data-toggle="modal" data-target="#incomeEditModal">').
								attr('value', categoryId).
								attr('name', categoryName).
								on('click', function() {
									var editValue = $(this).attr("value");
									var editName = $(this).attr("name");
									$('#editIncomeLabel').val(editName);
									$('#editIncomeId').val(editValue);
								}).
								append($('<i class="fa fa-pencil fa-fw">')),
							$('<button type="button" class="btn btn_record bg_record_del income_del" href="#incomeRemoveModal" data-toggle="modal" data-target="#incomeRemoveModal">').
								attr('value', categoryId).
								attr('name', categoryName).
								on('click', function() {
									var delValue = $(this).attr("value");
									var delName = $(this).attr("name");
									$('#deleteIncomeLabel').text(delName);
									$('#deleteIncomeId').val(delValue);
								}).
								append($('<i class="fa fa-trash fa-fw">'))
			))));
			$info.hide();
			$info.html('');
		} else {
			$info.show();
			$info.addClass('top10');
			$info.html(response.errors);
		}
    }).fail(function() {
		$info.show();
		$info.addClass('top10');
		$info.html('Błąd połączenia z bazą danych.');
	}).always(function() {
		$submitBtn.prop('disabled', false);
	});
});
</script>
<script>
$('button.js_button').click(function(){
  $(this).next('div.js_toggle_group').toggle("slow");
});

$('.income_del').on('click', function() {
	var delValue = $(this).attr("value");
	var delName = $(this).attr("name");
	$('#deleteIncomeLabel').text(delName);
	$('#deleteIncomeId').val(delValue);
});
$('.income_edit').on('click', function() {
	var editValue = $(this).attr("value");
	var editName = $(this).attr("name");
	$('#editIncomeLabel').val(editName);
	$('#editIncomeId').val(editValue);
});


//For the future
$('button.to_first').click(function(){
  $(this).closest('ul').prepend($(this).closest('li'));
});
$('.upbutton').on('click', function () {
    var previousObject = $(this).closest('li').prev('li');
	$(this).closest('li').insertBefore(previousObject);
});
$('.downbutton').on('click', function () {
    var nextObject = $(this).closest('li').next('li');
	$(this).closest('li').insertAfter(nextObject);
});
</script>
{% endblock %}